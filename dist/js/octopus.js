var Octopus=function(){var e=this;e.centers=ko.observableArray(model.centers),e.markers=ko.observableArray(),e.wikiList=ko.observableArray(),e.yelpList=ko.observableArray(),e.nyTimesList=ko.observableArray(),e.flickrList=ko.observableArray(),e.backUp=ko.observableArray(),e.currentInfo=ko.observable(),e.addedList=ko.observableArray(),e.searchField=ko.observable(""),e.filterInput=ko.observable(""),e.isFilterSelected=ko.observable(!1),e.isSearchSelected=ko.observable(!1),e.showRighSidebar=ko.observable(!0),e.menuIsDirty=ko.observable(!0),e.newPlaceFlag=!1,e.filterFlag=!1,e.filtered=!1,e.dbLoaded=!1,e.LoadedComplete=!1,e.newFrom="NULL",e.addedPlacesList=[],e.myDataRef=new Firebase("https://p5-neighborhood-map.firebaseio.com/"),e.showRightSideBar=function(a){e.showRighSidebar()?e.showRighSidebar(!1):e.showRighSidebar(!0)},e.onEnterSearch=function(a,t){var s=t.which;return 13==s?(e.searchNewPlace(),!1):!0},e.bottunShowInfo=ko.pureComputed(function(){return e.showRighSidebar()?" - Hide info":" - Show info"},e),e.showToast=function(e){"use strict";var a=document.querySelector("#toast-map-message"),t={message:e};a.MaterialSnackbar.showSnackbar(t)},e.filterInput.subscribe(function(a){if(null!==a&&""!==a){e.filterFlag=!0,e.clearMarkers();var t=a.toLowerCase();e.updateList(t),e.showMarkers(map),e.filterFlag=!1}else e.filterFlag=!0,e.restoreData(),e.showMarkers(map),e.filterFlag=!1,e.filtered=!1}),e.searchNewPlace=function(){null!==e.searchField()&&""!==e.searchField()?e.sendNewPlace():e.showToast("Type a place")},e.onLoadBody=function(){e.loadFirebase()},e.setIsFilterSelected=function(){e.isFilterSelected(!0)},e.setIsSearchSelected=function(){e.isSearchSelected(!0)},e.showMoreInfo=function(){e.showRightSideBar()},e.viewMarker=function(a){var t,s;for(s in e.markers())t=e.markers()[s].title,t===a&&google.maps.event.trigger(e.markers()[s],"click");e.showRightSideBar(),e.filterFlag||($("#menu-principal").removeClass("is-visible"),$(".mdl-layout__obfuscator").removeClass("is-visible"))},e.sendNewPlace=function(){e.newPlaceFlag=!0,e.dbLoaded=!1,e.newFrom="APP";var a={name:e.searchField(),location:e.searchField()+", PA"};pinPoster([a]),e.newPlaceFlag=!1,e.searchField(""),e.menuIsDirty(!1),e.isSearchSelected(!1)},e.loadFromFirebase=function(a){e.newPlaceFlag=!0,e.newFrom="FIREBASE",pinPoster(a)},e.updatedFirebase=function(){e.myDataRef.on("value",function(a){e.myDataRef.child("addedPlacesList").set(e.addedList())})},e.loadFirebase=function(){e.myDataRef.on("value",function(a){var t=a.exists();if(t&&e.LoadedComplete===!1){e.newFrom="NULL",e.dbLoaded=!0;var s=a.val();e.addedPlacesList=s.addedPlacesList,e.loadFromFirebase(e.addedPlacesList)}e.LoadedComplete=!0})},e.updateList=function(a,t){var s,r;if(e.filtered)for(s=e.backUp().length,e.centers.removeAll(),r=0;s>r;r++)e.centers.push(e.backUp.pop());for(s=e.centers().length,r=0;s>r;r++)e.backUp.push(e.centers()[r]);var i,o=[];for(r=0;s>r;r++)i=e.centers()[r].name.toLowerCase(),i.startsWith(a)&&o.push(e.centers()[r]);for(e.centers.removeAll(),r=0;r<o.length;r++)e.centers.push(o[r]);e.filtered=!0},e.restoreData=function(){var a,t=e.backUp().length;if(t>0)for(e.centers.removeAll(),a=0;t>a;a++)e.centers.push(e.backUp.pop())},e.loadWikiInfo=function(){var a="https://en.wikipedia.org/w/api.php?action=opensearch&search="+e.currentInfo().name+"&format=json&callback=wikiCallback";e.wikiList.removeAll(),$.ajax({url:a,dataType:"jsonp",success:function(a){var t,s=a[1],r=a[2];for(t=0;t<s.length;t++){var i=s[t],o=r[t],n="https://en.wikipedia.org/wiki/"+i;e.wikiList.push('<a href="'+n+'" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary" style="padding: 5px 5px;width:100%"><span class="mdl-list__item-primary-content"><i class="material-icons mdl-list__item-icon" style="color: white;">find_in_page</i> - '+i+'</a><p class="mdl-card__supporting-text">'+o+'</p><div class="android-drawer-separator"></div>')}}}).error(function(a){e.wikiList.push('<a class="mdl-navigation__link fix-pading-menu" style="padding: 5px 5px;">Relevant Wikipedia Links could not be loaded</a>')})},e.loadNYTimesInfo=function(){var a='http://api.nytimes.com/svc/search/v2/articlesearch.json?&fq=glocations.contains:("'+e.currentInfo().name+'")&api-key=0ed05b060b420f576bcfaffb4d33d845:10:74237526';e.nyTimesList.removeAll(),$.getJSON(a,function(a){var t=a.response.docs;for(doc in t){var s=t[doc];e.nyTimesList.push('<a href="'+s.web_url+'" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary" style="padding: 5px 5px;"><span class="mdl-list__item-primary-content"><i class="material-icons mdl-list__item-icon" style="color: white;">line_style</i> - '+s.headline.main+'</a><p class="mdl-card__supporting-text">'+s.snippet+'</p><div class="android-drawer-separator"></div>')}}).error(function(a){e.nyTimesList.push('<a class="mdl-navigation__link fix-pading-menu" style="padding: 5px 5px;">Relevant NY-Times Links could not be loaded</a>')})},e.loadYelpInfo=function(){var a={consumerKey:"uX9urW8948FOK9NL8FNgAw",consumerSecret:"UrfgKHHtzdnFN2irv2PcOWi0jio",accessToken:"9juC59OZki6K6aS-FhO_hTU6JSsiQofJ",accessTokenSecret:"g4Pg14xztkTCQrETWru_79xgODg",serviceProvider:{signatureMethod:"HMAC-SHA1"}},t={consumerSecret:a.consumerSecret,tokenSecret:a.accessTokenSecret};parameters=[],parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",a.consumerKey]),parameters.push(["oauth_consumer_secret",a.consumerSecret]),parameters.push(["oauth_token",a.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]);var s={action:"https://api.yelp.com/v2/search/?location="+e.currentInfo().location,method:"GET",parameters:parameters};OAuth.setTimestampAndNonce(s),OAuth.SignatureMethod.sign(s,t);var r=OAuth.getParameterMap(s.parameters);r.oauth_signature=OAuth.percentEncode(r.oauth_signature),e.yelpList.removeAll(),$.ajax({url:s.action,data:r,cache:!0,dataType:"jsonp",jsonpCallback:"cb",success:function(a,t,s){var r=a.businesses;for(business in r)e.yelpList.push('<a href="'+r[business].url+'" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary" style="padding: 5px 5px; width:100%;"><i class="material-icons mdl-list__item-icon" style="color: white;">filter_tilt_shift</i> - '+r[business].name+'</a><div class="material-icons mdl-badge mdl-badge--overlap" data-badge="'+r[business].rating+'" style="width: 30px;float: right;">start_rate</div><p class="mdl-card__supporting-text">'+r[business].snippet_text+'</p><div class="android-drawer-separator"></div>')}}).error(function(a){e.yelpList.push('<a class="mdl-navigation__link fix-pading-menu" style="padding: 5px 5px;">Relevant yelp Links could not be loaded</a>')})},e.loadFlickrImages=function(){var a="http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?";e.flickrList.removeAll(),$.getJSON(a,{tags:e.currentInfo().name,tagmode:"any",format:"json"}).done(function(a){$.each(a.items,function(a,t){var s='<div class="demo-card-image mdl-card mdl-shadow--2dp" style="width: 230px;margin-left: 5px;">';return s=s+'<img src="'+t.media.m+'" class="img-flickr"><div class="mdl-card__actions"><a href="'+t.link+'" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary" style="width:100%;padding: 0;"><i class="material-icons mdl-list__item-icon" style="color: white;">collections</i> - '+t.title+"</a></div></div>",e.flickrList.push(s),9===a?!1:void 0})}).error(function(a){e.flickrList.push('<a class="mdl-navigation__link fix-pading-menu" style="padding: 5px 5px;">Relevant flickr photos could not be loaded</a>')})},e.loadInfoSelected=function(){e.loadWikiInfo(),e.loadNYTimesInfo(),e.loadYelpInfo(),e.loadFlickrImages()},e.setMapOnAll=function(a){for(marker in e.markers())for(item in e.centers())e.centers()[item].name===e.markers()[marker].title&&e.markers()[marker].setMap(a)},e.clearMarkers=function(){e.setMapOnAll(null)},e.showMarkers=function(a){e.setMapOnAll(a)}},vM={viewModel:new Octopus};ko.applyBindings(vM.viewModel);
