function callback(e,i){i==google.maps.places.PlacesServiceStatus.OK?createMapMarker(e[0]):vM.viewModel.showToast("Sorry place not found")}function pinPoster(e){for(var i in e){var o={query:e[i].location};service.textSearch(o,callback)}}function initializeMap(){var e={disableDefaultUI:!0};map=new google.maps.Map(document.querySelector("#map"),e),service=new google.maps.places.PlacesService(map),infoWindow=new google.maps.InfoWindow({content:"marker"}),window.mapBounds=new google.maps.LatLngBounds,pinPoster(vM.viewModel.centers()),google.maps.event.addListener(map,"click",function(){$("#righ-sidebar").removeClass("is-visible"),infoWindow.close()})}function createMapMarker(e){var i=e.geometry.location.lat(),o=e.geometry.location.lng(),t=e.name,n=window.mapBounds,a=e.formatted_address,l=new google.maps.Marker({map:map,animation:google.maps.Animation.DROP,position:e.geometry.location,title:t});vM.viewModel.markers.push(l);var s=!1;for(item in vM.viewModel.addedPlacesList){var d=vM.viewModel.addedPlacesList[item];l.title===d.name&&(s=!0)}if(console.log(vM.viewModel.addedPlacesList),"APP"===vM.viewModel.newFrom||"FIREBASE"===vM.viewModel.newFrom&&s){var d={name:t,location:a};vM.viewModel.addedList.push(d);var r=!0;vM.viewModel.dbLoaded===!1&&(vM.viewModel.updatedFirebase(),r=!1),vM.viewModel.showToast(t+" added to list");var c="https://maps.googleapis.com/maps/api/streetview?size=400x200&location="+a;infoWindow.setContent("<h3>"+t+"</h3><h4>"+a+'</h4><br><center><img class="street-view-img" src="'+c+'"><button id="more-info" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored"><i class="material-icons mdl-list__item-icon" style="color: white;">visibility</i> - Show info</button></center>'),r===!1&&infoWindow.open(map,l),$("#more-info").click(function(){$(this).text(function(e,i){return"Hide info"===i?"Show info":"Hide info"}),$("#righ-sidebar").toggleClass("is-visible")}),"APP"===vM.viewModel.newFrom&&(vM.viewModel.newFrom="NULL"),vM.viewModel.currentInfo(d),vM.viewModel.loadInfoSelected()}google.maps.event.addListener(l,"click",function(){null!==l.getAnimation()?l.setAnimation(null):l.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){l.setAnimation(null)},1400);var e="",i=!0;for(center in vM.viewModel.addedList()){var o=vM.viewModel.addedList()[center].name;if(o===t){i=!1;var n="https://maps.googleapis.com/maps/api/streetview?size=400x200&location="+vM.viewModel.addedList()[center].location;e="<h3>"+vM.viewModel.addedList()[center].name+"</h3><h4>"+vM.viewModel.addedList()[center].location+'</h4><center><img class="street-view-img" src="'+n+'">',vM.viewModel.currentInfo(vM.viewModel.addedList()[center])}}if(i)for(center in vM.viewModel.centers()){var o=vM.viewModel.centers()[center].name;if(o===t){var n="https://maps.googleapis.com/maps/api/streetview?size=400x200&location="+vM.viewModel.centers()[center].location;e="<h3>"+vM.viewModel.centers()[center].name+"</h3><h4>"+vM.viewModel.centers()[center].location+'</h4><center><img class="street-view-img" src="'+n+'">',vM.viewModel.currentInfo(vM.viewModel.centers()[center])}}vM.viewModel.loadInfoSelected();var a;a="Hide info"===$("#more-info").text()?"Hide info":"Show info",e=e+'<br><button id="more-info" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect"><i class="material-icons mdl-list__item-icon" style="color: white;">visibility</i> - '+a+"</button></center>",infoWindow.setContent(e),vM.viewModel.filterFlag||infoWindow.open(map,l),$("#more-info").click(function(){$(this).text(function(e,i){return"Hide info"===i?"Show info":"Hide info"}),$("#righ-sidebar").toggleClass("is-visible")})}),n.extend(new google.maps.LatLng(i,o)),map.fitBounds(n),map.setCenter(n.getCenter())}function loadlayout(){$("#filter-title").click(function(){$("#menu-filter").addClass("is-focused"),$("#filter-input").focus()}),$("#title-search").click(function(){$("#main-search").addClass("is-focused"),$("#search-field").focus()});var e=$(window).innerHeight()-$(".android-header").height(),i=e-100;e+="px",i+="px",$("#mapDiv").css("height",e),$("#contest").css("height",i),$("#search-field").keypress(function(e){var i=e.which;13==i&&vM.viewModel.sendNewPlace()}),document.querySelector("#button-show-toast").addEventListener("click",function(){null!=$("#search-field").val()&&""!=$("#search-field").val()?vM.viewModel.sendNewPlace():vM.viewModel.showToast("Type a place")}),$("#filter-input").bind("keyup",function(){if(null!=$(this).val()&&""!=$(this).val()){vM.viewModel.filterFlag=!0,vM.viewModel.clearMarkers();var e=$(this).val().toLowerCase();vM.viewModel.updateList(e),vM.viewModel.showMarkers(map),vM.viewModel.filterFlag=!1}else vM.viewModel.filterFlag=!0,vM.viewModel.restoreData(),vM.viewModel.showMarkers(map),vM.viewModel.filterFlag=!1,vM.viewModel.filtered=!1}),$("#more-info-sidebar").click(function(){$("#more-info").text(function(e,i){return"Hide info"===i?"Show info":"Hide info"}),$("#righ-sidebar").toggleClass("is-visible")}),vM.viewModel.loadFirebase()}var map,infoWindow,service;window.addEventListener("load",initializeMap),window.addEventListener("resize",function(e){map.fitBounds(mapBounds)});var googleMap='<div id="map"></div>';$("#mapDiv").append(googleMap),$(window).resize(loadlayout),$(document).ready(function(){loadlayout()});
