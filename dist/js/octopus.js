var Octopus=function(){var e=this;e.centers=ko.observableArray(model.centers),e.markers=ko.observableArray(),e.wikiList=ko.observableArray(),e.yelpList=ko.observableArray(),e.nyTimesList=ko.observableArray(),e.flickrList=ko.observableArray(),e.backUp=ko.observableArray(),e.currentInfo=ko.observable(),e.addedList=ko.observableArray(),e.searchField=ko.observable(""),e.filterInput=ko.observable(""),e.isFilterSelected=ko.observable(!1),e.isSearchSelected=ko.observable(!1),e.newPlaceFlag=!1,e.filterFlag=!1,e.filtered=!1,e.dbLoaded=!1,e.LoadedComplete=!1,e.newFrom="NULL",e.addedPlacesList=[],e.myDataRef=new Firebase("https://glaring-fire-483.firebaseio.com/"),e.showToast=function(e){"use strict";var a=document.querySelector("#toast-map-message"),s={message:e};a.MaterialSnackbar.showSnackbar(s)},e.filterInput.subscribe(function(a){if(null!==a&&""!==a){e.filterFlag=!0,e.clearMarkers();var s=a.toLowerCase();e.updateList(s),e.showMarkers(map),e.filterFlag=!1}else e.filterFlag=!0,e.restoreData(),e.showMarkers(map),e.filterFlag=!1,e.filtered=!1}),e.searchNewPlace=function(){null!==e.searchField()&&""!==e.searchField()?e.sendNewPlace():e.showToast("Type a place")},e.onLoadBody=function(){var a=$(window).innerHeight()-$(".android-header").height(),s=a-100;a+="px",s+="px",$("#mapDiv").css("height",a),$("#contest").css("height",s),$("#search-field").keypress(function(a){var s=a.which;13==s&&e.sendNewPlace()}),e.loadFirebase()},e.setIsFilterSelected=function(){e.isFilterSelected(!0)},e.setIsSearchSelected=function(){e.isSearchSelected(!0)},e.showMoreInfo=function(){$("#more-info").text(function(e,a){return"Hide info"===a?"Show info":"Hide info"}),$("#righ-sidebar").toggleClass("is-visible")},e.viewMarker=function(a){var s,t;for(t in e.markers())s=e.markers()[t].title,s===a&&google.maps.event.trigger(e.markers()[t],"click");e.filterFlag||($("#menu-principal").removeClass("is-visible"),$(".mdl-layout__obfuscator").removeClass("is-visible"))},e.sendNewPlace=function(){e.newPlaceFlag=!0,e.dbLoaded=!1,e.newFrom="APP";var a={name:$("#search-field").val(),location:$("#search-field").val()+", PA"};pinPoster([a]),e.newPlaceFlag=!1,e.searchField(""),$("#main-search").removeClass("is-dirty"),e.isSearchSelected(!1)},e.loadFromFirebase=function(a){e.newPlaceFlag=!0,e.newFrom="FIREBASE",pinPoster(a)},e.updatedFirebase=function(){e.myDataRef.on("value",function(a){e.myDataRef.child("addedPlacesList").set(vM.viewModel.addedList())})},e.loadFirebase=function(){e.myDataRef.on("value",function(a){var s=a.exists();if(s&&e.LoadedComplete===!1){e.newFrom="NULL",e.dbLoaded=!0;var t=a.val();e.addedPlacesList=t.addedPlacesList,e.loadFromFirebase(e.addedPlacesList)}e.LoadedComplete=!0})},e.updateList=function(a,s){var t,i;if(e.filtered)for(t=e.backUp().length,e.centers.removeAll(),i=0;t>i;i++)e.centers.push(e.backUp.pop());for(t=e.centers().length,i=0;t>i;i++)e.backUp.push(e.centers()[i]);var r,o=[];for(i=0;t>i;i++)r=e.centers()[i].name.toLowerCase(),r.startsWith(a)&&o.push(e.centers()[i]);for(e.centers.removeAll(),i=0;i<o.length;i++)e.centers.push(o[i]);e.filtered=!0},e.restoreData=function(){var a,s=e.backUp().length;if(s>0)for(e.centers.removeAll(),a=0;s>a;a++)e.centers.push(e.backUp.pop())},e.loadWikiInfo=function(){var a="https://en.wikipedia.org/w/api.php?action=opensearch&search="+e.currentInfo().name+"&format=json&callback=wikiCallback";e.wikiList.removeAll(),$.ajax({url:a,dataType:"jsonp",success:function(a){var s,t=a[1],i=a[2];for(s=0;s<t.length;s++){var r=t[s],o=i[s],n="https://en.wikipedia.org/wiki/"+r;e.wikiList.push('<a href="'+n+'" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary" style="padding: 5px 5px;width:100%"><span class="mdl-list__item-primary-content"><i class="material-icons mdl-list__item-icon" style="color: white;">find_in_page</i> - '+r+'</a><p class="mdl-card__supporting-text">'+o+'</p><div class="android-drawer-separator"></div>')}}}).error(function(a){e.wikiList.push('<a class="mdl-navigation__link fix-pading-menu" style="padding: 5px 5px;">Relevant Wikipedia Links could not be loaded</a>')})},e.loadNYTimesInfo=function(){var a='http://api.nytimes.com/svc/search/v2/articlesearch.json?&fq=glocations.contains:("'+e.currentInfo().name+'")&api-key=0ed05b060b420f576bcfaffb4d33d845:10:74237526';e.nyTimesList.removeAll(),$.getJSON(a,function(a){var s=a.response.docs;for(doc in s){var t=s[doc];e.nyTimesList.push('<a href="'+t.web_url+'" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary" style="padding: 5px 5px;"><span class="mdl-list__item-primary-content"><i class="material-icons mdl-list__item-icon" style="color: white;">line_style</i> - '+t.headline.main+'</a><p class="mdl-card__supporting-text">'+t.snippet+'</p><div class="android-drawer-separator"></div>')}}).error(function(a){e.nyTimesList.push('<a class="mdl-navigation__link fix-pading-menu" style="padding: 5px 5px;">Relevant NY-Times Links could not be loaded</a>')})},e.loadYelpInfo=function(){var a={consumerKey:"uX9urW8948FOK9NL8FNgAw",consumerSecret:"UrfgKHHtzdnFN2irv2PcOWi0jio",accessToken:"9juC59OZki6K6aS-FhO_hTU6JSsiQofJ",accessTokenSecret:"g4Pg14xztkTCQrETWru_79xgODg",serviceProvider:{signatureMethod:"HMAC-SHA1"}},s={consumerSecret:a.consumerSecret,tokenSecret:a.accessTokenSecret};parameters=[],parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",a.consumerKey]),parameters.push(["oauth_consumer_secret",a.consumerSecret]),parameters.push(["oauth_token",a.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]);var t={action:"https://api.yelp.com/v2/search/?location="+e.currentInfo().location,method:"GET",parameters:parameters};OAuth.setTimestampAndNonce(t),OAuth.SignatureMethod.sign(t,s);var i=OAuth.getParameterMap(t.parameters);i.oauth_signature=OAuth.percentEncode(i.oauth_signature),e.yelpList.removeAll(),$.ajax({url:t.action,data:i,cache:!0,dataType:"jsonp",jsonpCallback:"cb",success:function(a,s,t){var i=a.businesses;for(business in i)e.yelpList.push('<a href="'+i[business].url+'" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary" style="padding: 5px 5px; width:100%;"><i class="material-icons mdl-list__item-icon" style="color: white;">filter_tilt_shift</i> - '+i[business].name+'</a><div class="material-icons mdl-badge mdl-badge--overlap" data-badge="'+i[business].rating+'" style="width: 30px;float: right;">start_rate</div><p class="mdl-card__supporting-text">'+i[business].snippet_text+'</p><div class="android-drawer-separator"></div>')}}).error(function(a){e.yelpList.push('<a class="mdl-navigation__link fix-pading-menu" style="padding: 5px 5px;">Relevant yelp Links could not be loaded</a>')})},e.loadFlickrImages=function(){var a="http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?";e.flickrList.removeAll(),$.getJSON(a,{tags:e.currentInfo().name,tagmode:"any",format:"json"}).done(function(a){$.each(a.items,function(a,s){var t='<div class="demo-card-image mdl-card mdl-shadow--2dp" style="width: 230px;margin-left: 5px;">';return t=t+'<img src="'+s.media.m+'" class="img-flickr"><div class="mdl-card__actions"><a href="'+s.link+'" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary" style="width:100%;padding: 0;"><i class="material-icons mdl-list__item-icon" style="color: white;">collections</i> - '+s.title+"</a></div></div>",e.flickrList.push(t),9===a?!1:void 0})}).error(function(a){e.flickrList.push('<a class="mdl-navigation__link fix-pading-menu" style="padding: 5px 5px;">Relevant flickr photos could not be loaded</a>')})},e.loadInfoSelected=function(){e.loadWikiInfo(),e.loadNYTimesInfo(),e.loadYelpInfo(),e.loadFlickrImages()},e.setMapOnAll=function(a){console.log(e.markers()),console.log(e.centers());for(marker in e.markers())for(item in e.centers())e.centers()[item].name===e.markers()[marker].title&&e.markers()[marker].setMap(a)},e.clearMarkers=function(){e.setMapOnAll(null)},e.showMarkers=function(a){e.setMapOnAll(a)}},vM={viewModel:new Octopus};ko.applyBindings(vM.viewModel);
