<!doctype html>
<html>
  <head>
    <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
  </head>
  <body>
    <div id='messagesDiv'></div>
    <input type='text' id='nameInput' placeholder='Name'>
    <input type='text' id='messageInput' placeholder='Message'>
    <script>
      var myDataRef = new Firebase('https://glaring-fire-483.firebaseio.com/');
      $('#messageInput').keypress(function (e) {
        if (e.keyCode == 13) {
          var name = $('#nameInput').val();
          var text = $('#messageInput').val();
          myDataRef.push({name: name, text: text});
          $('#messageInput').val('');
        }
      });
      var count = 0;
      myDataRef.on('value', function(db) {
        var a = db.exists();
        console.log(a);
        if(a){
          console.log('if');
          myDataRef.on('child_added', function(snapshot) {
            var model = snapshot.val();
            console.log(model);
            if(count === 0){
              var model2 = {
              	'centers' : [
              		{
              			'name' : 'Harrisburg, updated',
              			'location' : 'Harrisburg, PA'
              		},
              		{
              			'name' : 'Hershey, update',
              			'location' : 'Hershey, PA'
              		},
              		{
              			'name' : 'Philadelphia',
              			'location' : 'Philadelphia, PA'
              		},
              		{
              			'name' : 'Pittsburgh',
              			'location' : 'Pittsburgh, PA'
              		},
              		{
              			'name' : 'Reading',
              			'location' : 'Reading, PA'
              		}
              		,
              		{
              			'name' : 'Allentown',
              			'location' : 'Allentown, PA'
              		}
              		,
              		{
              			'name' : 'Gettysburg',
              			'location' : 'Gettysburg, PA'
              		}
                  ,
              		{
              			'name' : 'new added',
              			'location' : 'Gettysburg, PA'
              		}
              	]
              }
              myDataRef.child('centers').set(model2);
              count++;
            }
          });
        }
        else {
          console.log('else');
          var model = {
          	'centers' : [
          		{
          			'name' : 'Harrisburg',
          			'location' : 'Harrisburg, PA'
          		},
          		{
          			'name' : 'Hershey',
          			'location' : 'Hershey, PA'
          		},
          		{
          			'name' : 'Philadelphia',
          			'location' : 'Philadelphia, PA'
          		},
          		{
          			'name' : 'Pittsburgh',
          			'location' : 'Pittsburgh, PA'
          		},
          		{
          			'name' : 'Reading',
          			'location' : 'Reading, PA'
          		}
          		,
          		{
          			'name' : 'Allentown',
          			'location' : 'Allentown, PA'
          		}
          		,
          		{
          			'name' : 'Gettysburg',
          			'location' : 'Gettysburg, PA'
          		}
          	]
          }
          myDataRef.child('centers').set(model);
        }
      });


      function displayChatMessage(name, text) {
        $('<div/>').text(text).prepend($('<em/>').text(name+': ')).appendTo($('#messagesDiv'));
        $('#messagesDiv')[0].scrollTop = $('#messagesDiv')[0].scrollHeight;
      };
    </script>
  </body>
</html>
var myDataRef = new Firebase('https://glaring-fire-483.firebaseio.com/');
myDataRef.on('value', function(db) {
	var dataExist = db.exists();
	if(dataExist){
		console.log('if');
		model = db.val();
		console.log(model);
    vM.viewModel.centers(model.centers);
	}
	else {
		myDataRef.child('centers').set(model);
    vM.viewModel.centers(model.centers);
	}
});
